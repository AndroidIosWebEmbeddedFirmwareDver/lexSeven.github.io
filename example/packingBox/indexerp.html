<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no,maximum-scale=1">
    <style>
        body,
        html {
            height: 100%;
            overflow: hidden;
        }
        body {
            margin: 0;
            background: #fff;
        }
        .wraper {
            width: 100%;
            height: 100%;
            margin: 0 auto;
            perspective: 2000px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .cube {
            height: 500px;
            width: 500px;
            position: relative;
            transform-style: preserve-3d;
            transform: translateZ(-300px);
        }
        .cube > div {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            margin: auto;
            background-color: #ffb828;
            text-align: center;
            color: #fff;
            border: 1px solid #feb31a;
            user-select: none;
            box-sizing: border-box;
            font-size: 0;
            transition: 0s;
            transform-style: preserve-3d;
        }
        .fontface {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: translateZ(-1px);
            background: linear-gradient(#f2a639, #fca83b 30%, #f3972b 99%);
            border-left: 1px solid #f3972b;
            border-right: 1px solid #f3972b;
            box-sizing: border-box;
            /*box-shadow: 0 0 2px 0 rgba(0,0,0,0.1);*/
        }
        .cube .front,
        .cube .end,
        .cube .left,
        .cube .right {
            border-top-color: #f6c350;
        }
        .bottom .fontface {
            background: #fcb016;
            box-shadow: inset 0 0 15px 0 rgba(227, 137, 50, 0.7);
        }
        .cube .out {
            border: none;
            background-size: cover;
            transition: left 2s, opacity 0.5s;
        }

        .cube .outleft,.cube .outright{
            background-color: transparent;
        }

        .cube .coverfont,
        .cube .coverend,
        .cube .coverleft,
        .cube .coverright {
            height: 40%;
            background: #efefef;
            border: 1px solid #e9eaea;
            box-shadow: 0 2px 2px -2px rgba(174, 117, 0, 0.4);
            transition: top 1s, opacity 0.5s 1s;
        }
        .cube .covertop {
            background: #efefef;
            border: 1px solid #eee;
        }
        .cube .underfont,
        .cube .underend,
        .cube .underleft,
        .cube .underright {
            height: 40%;
            background: #efefef;
            border: 1px solid #e9eaea;
            border-top-color: #fff;
            box-shadow: 0 -2px 2px -2px rgba(174, 117, 0, 0.4);
        }
        .cube .underbottom {
            background: #ebebec;
            border: 1px solid #e9eaea;
        }
        .open {
            width: 50px;
            height: 50px;
            border: 1px solid #f3972b;
            border-radius: 50%;
            line-height: 50px;
            position: fixed;
            right: 50px;
            bottom: 50px;
            text-align: center;
        }
    </style>
</head>
<body>
<div class="wraper">
    <div class="cube">
        <div class="front"  data-name="boxFront">
            <div class="fontface"></div>
        </div>
        <div class="end"    data-name="boxEnd">
            <div class="fontface"></div>
        </div>
        <div class="left"   data-name="boxLeft">
            <div class="fontface"></div>
        </div>
        <div class="right"  data-name="boxRight">
            <div class="fontface"></div>
        </div>
        <div class="bottom" data-name="boxBottom">
            <div class="fontface"></div>
        </div>

        <div class="out outfont"></div>
        <div class="out outtop"></div>
        <div class="out outleft"></div>
        <div class="out outright"></div>
        <div class="out outend"></div>
        <div class="out outbottom"></div>

        <div class="coverfont"></div>
        <div class="coverend"></div>
        <div class="coverleft"></div>
        <div class="coverright"></div>
        <div class="covertop"></div>

        <div class="underfont"></div>
        <div class="underend"></div>
        <div class="underleft"></div>
        <div class="underright"></div>
        <div class="underbottom"></div>
    </div>

    <div class="open">打开</div>
</div>

<script>

    function handleSearch () {
        let search = window.location.search.substring(1).split('=')
        let searchObj = {};
        for(var i=0;i<search.length;i+=2){
            searchObj[search[i]] = search[i+1]
        }
        return searchObj
    }

    if(handleSearch().specId){
        ajax({
            type:"GET",
            url:"//las.secoo.com/api/giftpack/gift_img",
            dataType:"json",
            data:{
                "specId":handleSearch().specId,
            },
            success:function(data){
                Box(data.data.imgs)
            },
            error:function(){
                console.log("error")
            }
        })
    }else{
        console.log('记得传参数哦！')
    }


    function Box(data){
        let cube = document.querySelector(".cube"),
            downX, downY, moveX, moveY, tempX, tempY, degX = 0, degY = 0;

        let boxX = 190,
            boxY = 90,
            boxZ = 140,
            activeZ = 50,
            keyNum = 3;
        /*
        * boxX  盒子X轴（盒子的长）
        * boxY  盒子Y轴（盒子的高）
        * boxZ  盒子Z轴（盒子的宽）
        * activeZ 当点击其中一个面的时候，那个面在Z轴方向的运动距离
        * keyNum 当拖动盒子的时候，手指拖动距离和盒子转动距离的比例  越大盒子转动越慢
        * */

        let initDegX = -30;    // 初始化时盒子的X轴偏移量
        let initDegY = 0;      // 初始化时盒子的Y轴偏移量
        let translateZ = 1400;  // 盒子的Z轴偏移量，值越大，盒子越大
        let outImg = data;
        console.log(outImg);

        // 各个面（不需要动）
        let eleArr = {
            boxFront : cube.querySelector('.front'),
            boxEnd : cube.querySelector('.end'),
            boxLeft : cube.querySelector('.left'),
            boxRight : cube.querySelector('.right'),
            boxBottom : cube.querySelector('.bottom'),
            outFont: cube.querySelector('.outfont'),
            outTop: cube.querySelector('.outtop'),
            outLeft: cube.querySelector('.outleft'),
            outRight: cube.querySelector('.outright'),
            outEnd: cube.querySelector('.outend'),
            outBottom: cube.querySelector('.outbottom'),
            coverFont: cube.querySelector('.coverfont'),
            coverEnd: cube.querySelector('.coverend'),
            coverLeft: cube.querySelector('.coverleft'),
            coverRight: cube.querySelector('.coverright'),
            coverTop: cube.querySelector('.covertop'),
            underFont: cube.querySelector('.underfont'),
            underEnd: cube.querySelector('.underend'),
            underLeft: cube.querySelector('.underleft'),
            underRight: cube.querySelector('.underright'),
            underBottom: cube.querySelector('.underbottom'),
        };

        /*
        * 设定盒子中每一个面的宽，高，位置等信息，
        * 用对象来记录，主要方便后期对单独的一个面进行修改，而不需要另外去获取数据
        * */
        let eleData = {
            boxFront:{
                width:boxX,
                height:boxY,
                lineHeight:boxY,
                translateZ:boxZ/2,
                rotateX:0,
                rotateY:0
            },
            boxEnd:{
                width:boxX,
                height:boxY,
                lineHeight:boxY,
                translateZ:boxZ/2,
                rotateX:0,
                rotateY:180
            },
            boxLeft:{
                width:boxZ,
                height:boxY,
                lineHeight:boxY,
                translateZ:boxX/2,
                rotateX:0,
                rotateY:-90
            },
            boxRight:{
                width:boxZ,
                height:boxY,
                lineHeight:boxY,
                translateZ:boxX/2,
                rotateX:0,
                rotateY:90
            },
            boxBottom:{
                width:boxX,
                height:boxZ,
                lineHeight:boxZ,
                translateZ:boxY/2,
                rotateX:-90,
                rotateY:0
            },
            outFont:{
                width:boxX+4,
                height:boxY+4,
                lineHeight:boxY,
                translateZ:(boxZ/2+2),
                rotateX:0,
                rotateY:0,
                background: outImg.packageFrontImg || 'none'
            },
            outTop:{
                width:boxX+4,
                height:boxZ+4,
                lineHeight:boxZ,
                translateZ:(boxY/2+2),
                rotateX:90,
                rotateY:0,
                background: outImg.packageTopImg || 'none'
            },
            outLeft:{
                width:boxZ+4,
                height:boxY+4,
                lineHeight:boxY,
                translateZ:(boxX/2+2),
                rotateX:0,
                rotateY:-90,
                background: outImg.boxLeftTopImg || 'none'
            },
            outRight:{
                width:boxZ+4,
                height:boxY+4,
                lineHeight:boxY,
                translateZ:(boxX/2+2),
                rotateX:0,
                rotateY:90,
                background: outImg.boxRightTopImg || 'none'
            },
            outEnd:{
                width:boxX+4,
                height:boxY+4,
                lineHeight:boxY,
                translateZ:(boxZ/2+2),
                rotateX:0,
                rotateY:180,
                background: outImg.packageBackImg || 'none'
            },
            outBottom:{
                width:boxX+4,
                height:boxZ+4,
                lineHeight:boxZ,
                translateZ:(boxY/2+2),
                rotateX:-90,
                rotateY:0,
                background: outImg.packageButtonImg || 'none'
            },
            coverFont:{
                width:boxX+3,
                height:(boxY+2)*0.45,
                lineHeight:boxY,
                translateZ:(boxZ/2)+1,
                translateY:((boxY+2)*0.25)+2,
                rotateX:0,
                rotateY:0
            },
            coverEnd:{
                width:boxX+3,
                height:(boxY+2)*0.45,
                lineHeight:boxY,
                translateZ:(boxZ/2)+1,
                translateY:((boxY+2)*0.25)+2,
                rotateX:0,
                rotateY:180
            },
            coverLeft:{
                width:boxZ+3,
                height:(boxY+2)*0.45,
                lineHeight:boxY,
                translateZ:(boxX/2)+1,
                translateY:((boxY+2)*0.25)+2,
                rotateX:0,
                rotateY:-90
            },
            coverRight:{
                width:boxZ+3,
                height:(boxY+2)*0.45,
                lineHeight:boxY,
                translateZ:(boxX/2)+1,
                translateY:((boxY+2)*0.25)+2,
                rotateX:0,
                rotateY:90
            },
            coverTop:{
                width:boxX+4,
                height:boxZ+4,
                lineHeight:boxZ,
                translateZ:(boxY/2),
                rotateX:90,
                rotateY:0
            },
            underFont:{
                width:boxX+3,
                height:(boxY+2)*0.5,
                lineHeight:boxY,
                translateZ:(boxZ/2)+1,
                translateY:-((boxY+2)*0.25)-1,
                rotateX:0,
                rotateY:0
            },
            underEnd:{
                width:boxX+3,
                height:(boxY+2)*0.5,
                lineHeight:boxY,
                translateZ:(boxZ/2)+1,
                translateY:-((boxY+2)*0.25)-1,
                rotateX:0,
                rotateY:180
            },
            underLeft:{
                width:boxZ+3,
                height:(boxY+2)*0.5,
                lineHeight:boxY,
                translateZ:(boxX/2)+1,
                translateY:-((boxY+2)*0.25)-1,
                rotateX:0,
                rotateY:-90
            },
            underRight:{
                width:boxZ+3,
                height:(boxY+2)*0.5,
                lineHeight:boxY,
                translateZ:(boxX/2)+1,
                translateY:-((boxY+2)*0.25)-1,
                rotateX:0,
                rotateY:90
            },
            underBottom:{
                width:boxX+4,
                height:boxZ+4,
                lineHeight:boxZ,
                translateZ:(boxY/2)+1,
                rotateX:-90,
                rotateY:0
            }
        }

        /*
        * 初始化盒子，把设定好的数据放到对应的元素身上去
        * */
        setBox()
        function setBox(){
            cube.style.transform = "translateZ("+ translateZ +"px) rotatex(" + initDegX + "deg) rotatey(" + initDegY + "deg)";
            degX = initDegY;
            degY = initDegX;

            for(var a in eleData){
                css(eleArr[a],{
                    width:eleData[a].width + 'px',
                    height:eleData[a].height + 'px',
                    lineHeight:eleData[a].lineHeight + 'px',
                    transform:'rotateX('+ eleData[a].rotateX +'deg)\
                rotateY('+ eleData[a].rotateY +'deg)\
                translateZ('+ eleData[a].translateZ +'px)\
                translateY('+ (-eleData[a].translateY || 0) +'px)',
                    backgroundImage: 'url('+ (eleData[a].background || 'none') +')',
                    backgroundSize: 'cover'
                })
            }
        }

        document.onmousedown = function (e) {
            e = e || event;
            downX = e.clientX;
            downY = e.clientY;
            let isBack = false

            let caseY = (degY / 90) % 4;
            if(caseY > 1 && caseY < 3 || caseY < -1 && caseY > -3){
                isBack = true;
            }

            document.onmousemove = function (e) {
                e = e || event;
                moveX = e.clientX - downX;
                moveY = e.clientY - downY;

                if(isBack){
                    moveX = -moveX;
                }

                tempX = degX + moveX / keyNum;
                tempY = degY - moveY / keyNum;
                cube.style.transform = "translateZ("+ translateZ +"px) rotatex(" + tempY + "deg) rotatey(" + tempX + "deg)";
            };
            e.preventDefault();
        };


        document.onmouseup = function (e) {
            e = e || event;
            let domName = e.target.dataset.name;
            if(Math.abs(downX - e.clientX)<10 && Math.abs(downY - e.clientY)<10){
                if(eleArr[domName]){
                    if(e.target.active){
                        eleData[domName].translateZ -= activeZ;
                        e.target.active = false;
                    }else{
                        eleData[domName].translateZ += activeZ;
                        e.target.active = true;
                    }
                    css(e.target,{
                        transform:'rotateX('+ eleData[domName].rotateX +'deg)\
                    rotateY('+ eleData[domName].rotateY +'deg)\
                    translateZ('+ eleData[domName].translateZ +'px)'
                    })
                }
            }else{
                degX += moveX / keyNum;
                degY += - moveY / keyNum;
                degX %= 360;
                degY %= 360;
            }
            document.onmousemove = null;
        };
    }


    function css(target,styles){
        if(target.length){
            for(var i=0;i<target.length;i++){
                for (let k in styles){
                    target[i].style[k]=styles[k];
                }
            }
        }else{
            for (let k in styles){
                target.style[k]=styles[k];
            }
        }
    }

    // 去掉外包装
    // setTimeout(removeOut,100)
    function removeOut(){
        let leftDes = '500px'
        css([eleArr.outFont,eleArr.outTop,eleArr.outEnd,eleArr.outBottom],{
            left: leftDes
        })
    }
    // setTimeout(removeOut2,1000)
    function removeOut2(){
        css([eleArr.outFont,eleArr.outTop,eleArr.outEnd,eleArr.outBottom],{
            opacity: 0
        })
    }

    // setTimeout(removeCover,1500)
    function removeCover(){
        css([eleArr.coverFont,eleArr.coverEnd,eleArr.coverLeft,eleArr.coverRight,eleArr.coverTop],{
            top: '-100px',
            opacity: 0
        })
    }

    // 打开按钮
    let openBtn = document.querySelector('.open');
    openBtn.onclick = openBtn.ontouchend = function () {
        cube.style.transition = '1s'
        setTimeout(function(){
            cube.style.transform = "translateZ("+ translateZ +"px) rotatex(" + initDegX + "deg) rotatey(" + initDegY + "deg)";
            degX = initDegY;
            degY = initDegX;
        },100);

        setTimeout(function(){
            cube.style.transition = '0s'
            setTimeout(removeOut,100)
            setTimeout(removeOut2,1000)
            setTimeout(removeCover,1500)
        },1000);
    }


    function ajax(){
        var ajaxData = {
            type: (arguments[0].type || "GET").toUpperCase(),
            url: arguments[0].url || "",
            async: arguments[0].async || "true",
            data: arguments[0].data || null,
            dataType: arguments[0].dataType || "json",
            contentType: arguments[0].contentType || "application/x-www-form-urlencoded; charset=utf-8",
            beforeSend: arguments[0].beforeSend || function(){},
            success: arguments[0].success || function(){},
            error: arguments[0].error || function(){}
        }

        ajaxData.beforeSend()
        var xhr = createxmlHttpRequest();
        xhr.responseType=ajaxData.dataType;

        var params = [];
        for(var key in ajaxData.data){
            params.push(key + "=" + ajaxData.data[key]);
        }
        var sendData = params.join("&");
        if(ajaxData.type.toUpperCase() == "GET"){
            xhr.open(ajaxData.type, ajaxData.url + "?" + sendData, ajaxData.async);
            xhr.send(null);
        }else{
            xhr.open(ajaxData.type, ajaxData.url, ajaxData.async);
            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded; charset=utf-8");
            xhr.send(sendData);
        }

        xhr.onreadystatechange = function() {
            if (xhr.readyState == 4) {
                if(xhr.status == 200){
                    ajaxData.success(xhr.response)
                }else{
                    ajaxData.error()
                }
            }
        }
    }

    function createxmlHttpRequest() {
        if (window.ActiveXObject) {
            return new ActiveXObject("Microsoft.XMLHTTP");
        } else if (window.XMLHttpRequest) {
            return new XMLHttpRequest();
        }
    }

    function convertData(data){
        if( typeof data === 'object' ){
            var convertResult = "" ;
            for(var c in data){
                convertResult+= c + "=" + data[c] + "&";
            }
            convertResult=convertResult.substring(0,convertResult.length-1)
            return convertResult;
        }else{
            return data;
        }
    }


</script>

</body>
</html>