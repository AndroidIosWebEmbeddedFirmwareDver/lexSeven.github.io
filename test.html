<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>事件代理demo</title>
<style>
.div1{ width:10px; height:10px; border-width:50px; border-style:solid solid solid solid; border-color:#369 #f00 #0F0 #000; cursor:default;}
</style>
</head>

<body>
<div class="div1" data-drag="null" data-close="div2"></div>
<div class="div2" id="div2" data-drag="null">this well be close!</div>

<script>
var test = {
	/*初始化*/
	int:function(){
		var _this = test;
		_this.bindevent();
	},
	/*绑定事件*/
	bindevent:function(){
		var _this = test;
		bind(document,'mousedown',function( ev ){
			var ev = ev || event;
			var target = ev.target || srcElement;
			for(b in target.dataset){
				for(a in _this.clickArea){
					if( b == a){
						_this.clickArea[a]({obj:target,ev:ev,target:target.dataset[b]});
					}
				};
			}
			
		});
	},
	/*事件库*/
	clickArea:{
		drag:function(option){
			var obj = option.obj,ev = option.ev;
			obj.style.position = 'absolute';
			var downX = ev.clientX;
			var downY = ev.clientY;
			var objleft = downX - obj.offsetLeft;
			var objtop = downY - obj.offsetTop;
			obj.onmousemove = document.onmousemove = function( ev ){
				var ev = ev || event;
				obj.style.left = ev.clientX - objleft + 'px';
				obj.style.top = ev.clientY - objtop + 'px';
			}
			obj.onmouseup = document.onmouseup = function(){
				 obj.onmousemove = document.onmousemove = null;
			}
		},
		close:function( option ){
			var target = option.target;
			s(target).style.display = 'none';
		}
	}
	/*事件库*/
}

test.int();

/*---------------------工具函数------------------------------*/
function s(obj) {
    return document.getElementById(obj);
};

function bind(obj, ev, fn) { //事件绑定
    if (obj.addEventListener) {
        obj.addEventListener(ev, fn, false);
    } else {
        obj.attachEvent('on' + ev, function() {
            fn.call(obj);
        });
    }
}
</script>
</body>
</html>
