<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>妙味课堂-破茧成蝶</title>
<meta name="viewport" content="width=640,target-densityDpi=device-dpi, user-scalable=no">
<style>
*{ margin:0; padding:0;}
body{ font-family:Tahoma,Arial,Roboto,"Droid Sans","Helvetica Neue","Droid Sans Fallback","Heiti SC",sans-self; background: #000; }
li{ list-style:none;}
#main{ width:640px; overflow:hidden; position:relative;}
#ul1 > li{ width:100%; height:100%; background-repeat:no-repeat; background-size:cover; position:absolute; top:0; left:0; display:none; z-index:1;}
#ul1 > li.active{ z-index:2;}
#ul1 .li1Child{ color:white; font-size:30px; position:absolute; left:130px; top:680px;}
#ul1 .li1Child li{ opacity:0;}
#ul1 .li1Child li:nth-of-type(odd){ -webkit-transform:translate(-150px,0); }
#ul1 .li1Child li:nth-of-type(even){ -webkit-transform:translate(250px,0);}
#ul1 li:nth-of-type(2) div{ position:absolute; width:90px; height:90px; left:275px; top:600px;}
#ul1 li:nth-of-type(2) div:nth-of-type(1).active{ top:320px; left:275px;}
#ul1 li:nth-of-type(2) div:nth-of-type(2).active{ top:410px; left:450px;}
#ul1 li:nth-of-type(2) div:nth-of-type(3).active{ top:610px; left:460px;}
#ul1 li:nth-of-type(2) div:nth-of-type(4).active{ top:750px; left:275px;}
#ul1 li:nth-of-type(2) div:nth-of-type(5).active{ top:610px; left:90px;}
#ul1 li:nth-of-type(2) div:nth-of-type(6).active{ top:410px; left:90px;}
#ul1 li:nth-of-type(3) div{ width:460px; height:222px; background:url(img/d1.png) no-repeat; position:absolute; left:96px; top:696px;}
#ul1 li:nth-of-type(4) div{ border:1px white solid; position:absolute;  -webkit-box-shadow:0px 0px 30px white; border-radius:5px; font-size:21px; color:white; word-wrap:break-word; padding:5px; width:0; height:0; overflow:hidden;}
#ul1 li:nth-of-type(4) div:nth-of-type(1).active{ width:182px; height:258px;}
#ul1 li:nth-of-type(4) div:nth-of-type(2).active{ width:307px; height:140px;}
#ul1 li:nth-of-type(4) div:nth-of-type(3).active{ width:96px; height:227px;}
#ul1 li:nth-of-type(4) div:nth-of-type(4).active{ width:233px; height:129px;}
#ul1 li:nth-of-type(4) div:nth-of-type(5).active{ width:166px; height:236px;}

#c1{position:absolute; left:0; top:0; z-index:10;}
#arrow{ width:90px; height:52px; background:url(img/arr.png) no-repeat; position:absolute; bottom:50px; left:50%; margin-left:-45px; z-index:3; -webkit-transform: translate(0,42px); -webkit-animation:arrowTop 1.5s infinite;}
@-webkit-keyframes arrowTop{
	0%{-webkit-transform: translate(0,42px); opacity: 0;}
	60%{-webkit-transform: translate(0,12px); opacity: 1;}
	100%{-webkit-transform: translate(0,0); opacity: 0;}
}
#music{ width:55px; height:55px; background:url(img/music.png) no-repeat; position:absolute; top:20px; right:20px; z-index:3; background-size:cover;}
#music.run{-webkit-animation:musicRotate 1.5s infinite linear;}
@-webkit-keyframes musicRotate{
	from {-webkit-transform:rotate(0deg);}
	to {-webkit-transform:rotate(360deg);}
}
#loading{ width:100%; height:100%; background:white;position:absolute; left:0; top:0; z-index:20; color:#5fb336;}
#loading ul{ position:fixed; top:40%; left:50%; margin-left:-30px;}
#loading div{ position:fixed; top:50%; width:100%; text-align:center; font-size:40px;}
#loading ul li{ width:5px; height:50px; float:left; margin-right:5px; -webkit-animation:loadingRun 2s infinite;  background:#5fb336;}
@-webkit-keyframes loadingRun{
  0%, 80%, 100% { -webkit-transform: scaleY(1.0) }
  40% { -webkit-transform: scaleY(0.3) }
}
#loading ul li:nth-of-type(1){
  -webkit-animation-delay: -1.1s;
}
#loading ul li:nth-of-type(2){
  -webkit-animation-delay: -0.9s;
}
#loading ul li:nth-of-type(3){
  -webkit-animation-delay: -0.7s;
}
#loading ul li:nth-of-type(4){
  -webkit-animation-delay: -0.5s;
}
#loading ul li:nth-of-type(5){
  -webkit-animation-delay: -0.3s;
}
#loading ul li:nth-of-type(6){
  -webkit-animation-delay: -0.1s;
}


</style>
<script src="jquery-2.1.3.min.js"></script>
<script>
$(document).on('touchmove',function(ev){
	ev.preventDefault();
});
//alert( $(window).width() );  //980(默认视口的宽度)

$(function(){
	var viewHeight = $(window).height();
	var $Li = $('#ul1').find('>li');
	$('#main').css('height',viewHeight);
	
	loadImg();
	slideCanvas();
	slideImg();
	
	function slideCanvas(){
		var $c = $('#c1');
		var gc = $c.get(0).getContext('2d');
		$c.attr('height',viewHeight);
		var yImg = new Image();
		yImg.src = 'img/a.png';
		yImg.onload = function(){
			gc.drawImage(yImg,0,0,640,viewHeight);
			var r = 30;
			var bBtn = true;
			gc.lineWidth = r*2;
			gc.strokeStyle = 'red';
			gc.lineCap = 'round';
			gc.globalCompositeOperation = 'destination-out';
			$c.on('touchstart',function(ev){
				var touchs = ev.originalEvent.changedTouches[0];
				var x = touchs.pageX - $(this).offset().left;
				var y = touchs.pageY - $(this).offset().top;
				if(bBtn){
					gc.moveTo(x,y);
					gc.lineTo(x+1,y+1);
					gc.stroke();
					bBtn = false;
				}
				else{
					gc.lineTo(x,y);
					gc.stroke();
				}			
				$(this).on('touchmove',function(ev){
					var touchs = ev.originalEvent.changedTouches[0];
					var x = touchs.pageX - $(this).offset().left;
					var y = touchs.pageY - $(this).offset().top;
					gc.lineTo(x,y);
					gc.stroke();
				});
				$(this).on('touchend',function(ev){
					var img = gc.getImageData(0,0,640,viewHeight);
					var allpx = 640*viewHeight;
					var sumpx = 0;
					for(var i=0;i<allpx;i++){
						if(img.data[4*i+3] == 0){
							sumpx++; 
						}
					}
					if(sumpx>allpx/2){
						$c.animate({opacity:0},1000,function(){
							$(this).remove();
							sceneAnimate[0].inAn();
						});
						musicShow();
					}
					$(this).off('touchmove');
					$(this).off('touchend');
				});
			});
		};
	}
	function slideImg(){
		var startPageY = 0;
		var step = 0.25;
		var nowIndex = 0;
		var nextorperIndex = 0;
		var bBtn = true;
		$Li.on('touchstart',function(ev){
			if(bBtn){
				bBtn = false;
				var touchs = ev.originalEvent.changedTouches[0];
				startPageY = touchs.pageY;
				nowIndex = $(this).index();
				$(this).on('touchmove.drag',function(ev){
					var touchs = ev.originalEvent.changedTouches[0];
					var scaleY = (touchs.pageY - startPageY )*step;
					if(touchs.pageY - startPageY<0){
						$(this).css('transform','translate(0,'+ scaleY +'px) scale(' + (1 - Math.abs(scaleY / viewHeight)) + ')');
						nextorperIndex = nowIndex==$Li.length-1 ? 0 : nowIndex+1;
						$Li.eq(nextorperIndex).css('transform','translate(0,'+ (viewHeight + (touchs.pageY - startPageY))  +'px)');
						$Li.eq(nextorperIndex).show().addClass('active');
					}
					else if(touchs.pageY - startPageY>0){
						$(this).css('transform','translate(0,'+ scaleY +'px) scale(' + (1 - Math.abs(scaleY / viewHeight)) + ')');
						nextorperIndex = nowIndex==0 ? $Li.length-1 : nowIndex-1;
						$Li.eq(nextorperIndex).css('transform','translate(0,'+ (-viewHeight + (touchs.pageY - startPageY))  +'px)');
						$Li.eq(nextorperIndex).show().addClass('active');
					}
				});
				$(this).on('touchend.drag',function(ev){
					var touchs = ev.originalEvent.changedTouches[0];
					if(touchs.pageY - startPageY<0){
						$(this).css('transform','translate(0,'+ -viewHeight*step +'px) scale(' + (1 - step) + ')');
					}
					else if(touchs.pageY - startPageY>0){
						$(this).css('transform','translate(0,'+ viewHeight*step +'px) scale(' + (1 - step) + ')');
					}
					$(this).css('transition','all .3s');
					$Li.eq(nextorperIndex).css('transform','translate(0,0)');
					$Li.eq(nextorperIndex).css('transition','all .3s');
					$(this).off('.drag');
				});
			}
		});
		$Li.on('webkitTransitionEnd',function(ev){
			if( !$Li.is(ev.target) ){ return; }
			resetFn();
			if(sceneAnimate[nowIndex]){
				sceneAnimate[nowIndex].outAn();
			}
			if(sceneAnimate[nextorperIndex]){
				sceneAnimate[nextorperIndex].inAn();
			}
		});
		function resetFn(){
			bBtn = true;
			$Li.css('transition','');
			$Li.css('transform','');
			$Li.eq(nextorperIndex).removeClass('active').siblings().hide();
		}
	}
	
	var sceneAnimate = [
		{ 
			outAn : function(){
				var $childLi = $Li.eq(0).find('li');
				$childLi.css('opacity',0);
				$childLi.filter(':odd').css('transform','translate(-150px,0)');
				$childLi.filter(':even').css('transform','translate(250px,0)');
			},
			inAn : function(){
				var $childLi = $Li.eq(0).find('li');
				$childLi.css('transform','translate(0,0)');
				$childLi.css('opacity',1);
				$childLi.css('transition','all 1s');
			} 
		},
		{ 
			outAn : function(){
				var $childDiv = $Li.eq(1).find('div');
				$childDiv.attr('class','');
				$childDiv.css('transform','rotate(0)');
			},
			inAn : function(){
				var $childDiv = $Li.eq(1).find('div');
				$childDiv.attr('class','active');
				$childDiv.css('transform','rotate(720deg)');
				$childDiv.css('transition','all 1s');
			} 
		},
		{ 
			outAn : function(){
				var $childDiv = $Li.eq(2).find('div');
				$childDiv.css('transform','rotateY(0)');
			},
			inAn : function(){
				var $childDiv = $Li.eq(2).find('div');
				$childDiv.css('transform','rotateY(360deg)');
				$childDiv.css('transition','all 1s');
			} 
		},
		{ 
			outAn : function(){
				var $childDiv = $Li.eq(3).find('div');
				$childDiv.attr('class','');
			},
			inAn : function(){
				var $childDiv = $Li.eq(3).find('div');
				$childDiv.attr('class','active');
				$childDiv.css('transition','all 1s');
			} 
		}
	];
	
	function musicShow(){
		var au = $('#music').find('audio').get(0);
		au.play();
		$('#music').addClass('run');
		
		$('#music').on('touchstart',function(){
			if(au.paused){
				au.play();
				$('#music').addClass('run');
			}
			else{
				au.pause();
				$('#music').removeClass('run');
			}
		});
	}
	
	function loadImg(){
		var arr = ['img/a.png','img/b.png','img/c.png','img/d.png','img/e.png','img/ad1.jpg','img/ad2.jpg','img/ad3.jpg','img/ad4.jpg','img/arr.png','img/c1.png','img/c2.png','img/c3.png','img/c4.png','img/c5.png','img/c6.png','img/d1.png','img/music.png'];
		var imgNow = 0;
		$.each(arr,function(i,img){
			var yImg = new Image();
			yImg.src = img;
			yImg.onload = function(){
				imgNow++;
				if(imgNow==arr.length){
					$('#loading').animate({opacity:0},1000,function(){
						$(this).remove();
					});
				}
			};
			yImg.error = function(){
				$('#loading').animate({opacity:0},1000,function(){
					$(this).remove();
				});
			}
		});
	}
	
});

</script>
</head>
<body>
<img src="img/logo.jpg" style="position:absolute; top:-999px; left:-8888px;" />
<div id="main">
	<div id="loading">
    	<ul>
        	<li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
        <div>您的技能是否会逐渐满载...</div>
    </div>
	<canvas id="c1" width="640"></canvas>
    <ul id="ul1">
    	<li style="background:url(img/b.png); display:block">
        	<ul class="li1Child">
            	<li>
                	<p>曾经做为前端开发的你</p>
                    <p>为解决PC兼容性问题而焦头烂额</p>
                </li>
                <li>
                	<p>而今</p>
                    <p>移动端H5应用疯狂来袭</p>
                </li>
                <li>
                	<p>你是否已准备充分</p>
                    <p>学习新技能</p>
                </li>
                <li>
                	<p>曾破茧成蝶、重获新生？</p>
                </li>
            </ul>
        </li>
        <li style="background:url(img/c.png);">
        	<div style="background:url(img/c1.png);"></div>
            <div style="background:url(img/c2.png);"></div>
            <div style="background:url(img/c3.png);"></div>
            <div style="background:url(img/c4.png);"></div>
            <div style="background:url(img/c5.png);"></div>
            <div style="background:url(img/c6.png);"></div>
        </li>
        <li style="background:url(img/d.png);">
        	<div></div>
        </li>
        <li style="background:url(img/e.png) no-repeat;">
        	<div style="left:27px;top:146px;">transform  transition  rotate  scale  translate  keyframes animation  webkitTransitionEnd webkitAnimationIteration elapsedTime perspective…</div>
            <div style="left:312px;top:185px;">drawImage lineWidth  strokeStyle  lineCap  globalCompositeOperation  moveTo   lineTo  stroke  arc  getImageData…</div>
            <div style="left:523px;top:432px;">audio autoplay loop  paused  play  pause…</div>
            <div style="left:329px;top:776px;">viewport  touchstart  touchmove  touchend  changedTouches…</div>
            <div style="left:60px;top:705px;">on() off()  css()  eq() siblings()  show()   hide()  find() trigger()remove()  animate() originalEv...</div>
        </li>
        <li style="background:url(img/ad1.jpg);">
        </li>
        <li style="background:url(img/ad2.jpg);">
        </li>
        <li style="background:url(img/ad3.jpg);">
        </li>
        <li style="background:url(img/ad4.jpg);">
        </li>
    </ul>
    <div id="arrow"></div>
    <div id="music">
    	<audio loop="" src="img/music.mp3" preload style="display:none;"></audio>
    </div>
</div>
</body>
</html>
